# Solefood MVP v9.0 Plus - PokÃ©mon GO é¢¨æ ¼å¯¦æ–½æŒ‡å—

## ğŸ¯ æ¦‚è¿°

v9.0 Plus ç‰ˆæœ¬å¾¹åº•é‡æ–°è¨­è¨ˆäº† UI/UXï¼Œæ¡ç”¨ **PokÃ©mon GO é¢¨æ ¼**ï¼Œå¯¦ç¾äº†ï¼š
- âœ… æ¥µç°¡ã€ä¸æ“‹åœ°åœ–çš„ä½ˆå±€ï¼ˆ90% åœ°åœ–å¯è¦‹åº¦ï¼‰
- âœ… å®Œæ•´ç‹€æ…‹æ©Ÿé‚è¼¯ï¼ˆIDLE â†’ COLLECTING â†’ UNLOADING/PICNICï¼‰
- âœ… ç£å¸ç³»çµ±ï¼ˆè‡ªå‹•æª¢æ¸¬ç‰©å“ + æ™ºèƒ½æ•‘æ´ï¼‰
- âœ… é›¶æ•™å­¸ UIï¼ˆæ‰€æœ‰åé¥‹é€šéé£„å­— + éœ‡å‹•ï¼‰
- âœ… å»£å‘Šæ•‘æ´ç³»çµ±ï¼ˆè…ä¸Šè…ºç´ ã€è‡¨æ™‚æ“´å®¹ã€éˆé­‚å¾©æ´»ï¼‰

---

## ğŸ“‚ æ–°å¢æª”æ¡ˆæ¸…å–®

### 1. UI çµ„ä»¶ï¼ˆ`src/components/game/`ï¼‰
- **BackpackCard.tsx** - å³ä¸‹è§’èƒŒåŒ…å¡ç‰‡ï¼ˆPokÃ©mon GO é¢¨æ ¼ï¼‰
- **TopStaminaBar.tsx** - é ‚éƒ¨æ¥µç°¡é«”åŠ›æ¢
- **MainActionButton.tsx** - åº•éƒ¨ä¸»æŒ‰éˆ•ï¼ˆä¸‰æ…‹ï¼šå¾…å‘½/æ¡é›†ä¸­ï¼‰
- **FloatingTextSystem.tsx** - é£„å­—åé¥‹ç³»çµ±
- **RescueModal.tsx** - æ•‘æ´å½ˆçª—ç³»çµ±ï¼ˆå»£å‘Šè§¸ç™¼ï¼‰
- **LeftToolbar.tsx** - å·¦å´å·¥å…·æ¬„ï¼ˆæ­·å²ã€å®šä½ã€å¿«é€Ÿé£Ÿç”¨ï¼‰

### 2. æ ¸å¿ƒç³»çµ±ï¼ˆ`src/systems/`ï¼‰
- **MagnetSystem.ts** - ç£å¸ç³»çµ±ï¼ˆå®Œæ•´ç™½çš®æ›¸é‚è¼¯ï¼‰
- **index.ts** - ç³»çµ±åŒ¯å‡º

### 3. ä¸»ç•«é¢
- **app/(tabs)/index_v9_plus.tsx** - å…¨æ–° PokÃ©mon GO é¢¨æ ¼ä¸»ç•«é¢

---

## ğŸš€ å•Ÿç”¨ v9.0 Plus

### æ–¹æ³• 1ï¼šæ›¿æ›ä¸»ç•«é¢ï¼ˆå»ºè­°ï¼‰

å°‡èˆŠçš„ `index.tsx` å‚™ä»½ï¼Œç„¶å¾Œé‡å‘½åæ–°æ–‡ä»¶ï¼š

```bash
cd /Users/yumingliao/YML/solefoodmvp/app/(tabs)
mv index.tsx index_old_backup.tsx
mv index_v9_plus.tsx index.tsx
```

### æ–¹æ³• 2ï¼šä¸¦è¡Œæ¸¬è©¦ï¼ˆä¿å®ˆï¼‰

ä¿ç•™èˆŠç‰ˆæœ¬ï¼Œåœ¨ `app.json` æˆ–è·¯ç”±é…ç½®ä¸­åˆ‡æ›ï¼š

```typescript
// åœ¨ _layout.tsx ä¸­å‹•æ…‹åˆ‡æ›
import GameScreenV9Plus from './index_v9_plus';
// æˆ–
import GameScreen from './index';
```

---

## ğŸ¨ UI ä½ˆå±€ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ é«”åŠ› 90/100 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘        [âš™ï¸]  â”‚ â† TopStaminaBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚                                         â”‚
â”‚                                         â”‚
â”‚              åœ°åœ–å…¨å±é¡¯ç¤º                 â”‚
â”‚           (æœ€å¤§åŒ–éŠæˆ²è¦–é‡)               â”‚
â”‚                                         â”‚
â”‚  [ğŸ—ºï¸]                            â”Œâ”€â”€â”€â”€â”â”‚
â”‚  [ğŸ“]                            â”‚ğŸ“¦  â”‚â”‚ â† BackpackCard
â”‚                                  â”‚7.5 â”‚â”‚
â”‚                                  â”‚10kgâ”‚â”‚
â”‚                                  â””â”€â”€â”€â”€â”˜â”‚
â”‚                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚        â”‚   START SHIFT    â”‚            â”‚ â† MainActionButton
â”‚        â”‚       â–¶ï¸         â”‚            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                         â”‚
â”‚    ã€æ¡é›†ä¸­è®Šç‚ºã€‘                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚ğŸš— å¸è²¨ â”‚  â”‚ğŸ½ï¸ é‡é¤ â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ç‹€æ…‹æ©Ÿé‚è¼¯

### ç‹€æ…‹è½‰æ›åœ–

```
IDLE (å¾…å‘½)
  â†“ [æŒ‰ START SHIFT]
  â†“ [æª¢æŸ¥: è€ä¹…åº¦ > 0, é«”åŠ› > 0]
  â†“
COLLECTING (æ¡é›†ä¸­)
  â†“ [ç£å¸ç³»çµ±é‹è¡Œ]
  â†“ [ç©å®¶é¸æ“‡]
  â”œâ†’ [æŒ‰å¸è²¨] â†’ UNLOADING â†’ IDLE
  â””â†’ [æŒ‰é‡é¤] â†’ PICNIC â†’ IDLE
```

### æ ¸å¿ƒæª¢æŸ¥ï¼ˆé–‹å§‹æ¡é›†æ™‚ï¼‰

1. **é›¶å®¹å¿ - è€ä¹…åº¦**
   - `durability <= 0` â†’ é˜»æ“‹ï¼Œå½ˆå‡ºã€ŒèƒŒåŒ…å·²ææ¯€ã€
   
2. **é›¶å®¹å¿ - é«”åŠ›**
   - `stamina <= 0` â†’ è§¸ç™¼ã€Œéˆé­‚å¾©æ´»ã€æ•‘æ´å½ˆçª—

3. **é€šéæª¢æŸ¥**
   - å•Ÿå‹•èƒŒæ™¯æœå‹™ï¼ˆGPS è¿½è¹¤ + é€šçŸ¥ï¼‰
   - å•Ÿå‹•ç£å¸ç³»çµ±
   - ç‹€æ…‹ â†’ `COLLECTING`

---

## ğŸ§² ç£å¸ç³»çµ±é‚è¼¯

### A. T3 å¤§çé‚è¼¯ï¼ˆåŸå­ä¿è­·ï¼‰

```typescript
if (item.tier === 3) {
  1. æš«åœç£å¸ç³»çµ±
  2. å¯«å…¥åŸå­ä¿è­·æ¨™è¨˜ï¼ˆé˜²é–ƒé€€ï¼‰
  3. è§¸ç™¼éœ‡å‹•ï¼ˆWARNINGï¼‰
  4. é¡¯ç¤ºå…¨è¢å¹•ç¢ºèªå½ˆçª—
  5. ç”¨æˆ¶ç¢ºèªå¾Œæ‹¾å–ï¼ˆæ¶ˆè€— 30 é«”åŠ›ï¼‰
}
```

### B. é«”åŠ›ä¸è¶³é‚è¼¯

```typescript
if (stamina < item.pickupCost) {
  1. æš«åœç£å¸ç³»çµ±
  2. é¡¯ç¤ºã€Œè…ä¸Šè…ºç´ ã€æ•‘æ´å½ˆçª—
  3. ç”¨æˆ¶è§€çœ‹å»£å‘Š â†’ +30 é«”åŠ› â†’ è‡ªå‹•æ‹¾å–
  4. ç”¨æˆ¶å–æ¶ˆ â†’ æ”¾æ£„ç‰©å“
}
```

### C. æ»¿å€‰é‚è¼¯

#### C-1: T1 è‡ªå‹•é£Ÿç”¨ï¼ˆé›¶å¹²æ“¾ï¼‰

```typescript
if (isFull && item.tier === 1) {
  1. è‡ªå‹•é£Ÿç”¨ï¼ˆä¸å½ˆçª—ï¼‰
  2. é«”åŠ› += (restoreStamina - pickupCost) // é€šå¸¸ +2
  3. é¡¯ç¤ºé£„å­—ï¼š"+2 âš¡"
  4. éœ‡å‹•åé¥‹ï¼ˆLIGHTï¼‰
}
```

#### C-2: T2 è‡¨æ™‚æ“´å®¹

```typescript
if (isFull && item.tier === 2) {
  1. æš«åœç£å¸ç³»çµ±
  2. é¡¯ç¤ºã€Œè‡¨æ™‚æ“´å®¹ã€æ•‘æ´å½ˆçª—
  3. ç”¨æˆ¶è§€çœ‹å»£å‘Š â†’ +50% å®¹é‡ â†’ è‡ªå‹•æ‹¾å–
  4. ç”¨æˆ¶å–æ¶ˆ â†’ æ”¾æ£„ç‰©å“
}
```

### D. æ­£å¸¸æ‹¾å–ï¼ˆHappy Pathï¼‰

```typescript
1. æª¢æŸ¥å®¹é‡å’Œé«”åŠ›
2. æ‰£é™¤é«”åŠ›
3. åŠ å…¥èƒŒåŒ…
4. é¡¯ç¤ºé£„å­—ï¼š"+1 ç¥ç€ç³–" / "+1 ç¿¡ç¿ æ™¶ç³–"
5. éœ‡å‹•åé¥‹ï¼ˆLIGHTï¼‰
```

---

## ğŸ“± å»£å‘Šæ•‘æ´ç³»çµ±

### æ•‘æ´é¡å‹

| é¡å‹ | è§¸ç™¼æ¢ä»¶ | çå‹µ | çµæœ |
|------|---------|------|------|
| **è…ä¸Šè…ºç´ ** | é«”åŠ› < æ‹¾å–æˆæœ¬ | +30 é«”åŠ› | è‡ªå‹•æ‹¾å–ç‰©å“ |
| **è‡¨æ™‚æ“´å®¹** | èƒŒåŒ…æ»¿ + æª¢æ¸¬åˆ° T2 | +50% å®¹é‡ | è‡ªå‹•æ‹¾å–ç‰©å“ |
| **éˆé­‚å¾©æ´»** | é«”åŠ› = 0ï¼ˆé–‹å§‹æ¡é›†æ™‚ï¼‰ | +30 é«”åŠ› | å…è¨±é–‹å§‹æ¡é›† |

### ä½¿ç”¨ç¤ºä¾‹

```typescript
// åœ¨ RescueModal ä¸­
<RescueModal
  visible={rescueModalVisible}
  type="Adrenaline" // æˆ– "TempExpansion" / "GhostRevival"
  title="é«”åŠ›ä¸è¶³"
  desc="éœ€è¦ 3 é«”åŠ›\nè§€çœ‹å»£å‘Š +30 é«”åŠ›ä¸¦è‡ªå‹•æ‹¾å–ï¼Ÿ"
  reward="+30 é«”åŠ›"
  onAdSuccess={handleAdSuccess}
  onCancel={handleAdCancel}
/>
```

---

## ğŸ’¬ é£„å­—åé¥‹ç³»çµ±

### ä½¿ç”¨æ–¹å¼

```typescript
import { useFloatingText } from '../../src/components/game';

const { texts, showFloatingText, removeText } = useFloatingText();

// é¡¯ç¤ºé£„å­—
showFloatingText('+5 âš¡', '#4CAF50'); // ä¸­å¤®
showFloatingText('-3 âš¡', '#FF9800', 45, 55); // è‡ªå®šç¾©ä½ç½®ï¼ˆç™¾åˆ†æ¯”ï¼‰

// æ¸²æŸ“é£„å­—
<FloatingTextSystem texts={texts} onRemove={removeText} />
```

### æ¨™æº–é£„å­—é…è‰²

- ğŸŸ¢ **ç¶ è‰²** (`#4CAF50`) - æ­£é¢åé¥‹ï¼ˆé«”åŠ›æ¢å¾©ã€æˆåŠŸæ‹¾å–ï¼‰
- ğŸŸ  **æ©™è‰²** (`#FF9800`) - æ¶ˆè€—æç¤ºï¼ˆé«”åŠ›æ¶ˆè€—ï¼‰
- ğŸ”µ **è—è‰²** (`#2196F3`) - è³‡è¨Šæç¤ºï¼ˆé‡æ–°å®šä½ï¼‰
- ğŸ”´ **ç´…è‰²** (`#F44336`) - éŒ¯èª¤æç¤ºï¼ˆå¤±æ•—ï¼‰
- ğŸŸ¡ **é»ƒè‰²** (`#FFC107`) - T1 ç‰©å“
- ğŸŸ£ **ç´«è‰²** (`#9C27B0`) - T3 ç‰©å“

---

## ğŸ”§ é–‹ç™¼è€…å·¥å…·

### DevDashboard æ•´åˆ

DevDashboard å·²æ•´åˆåˆ°æ–°ç‰ˆæœ¬ä¸­ï¼Œå¯é€šéé ‚éƒ¨ç‹€æ…‹æ¬„å³å´çš„ âš™ï¸ æŒ‰éˆ•åˆ‡æ›é¡¯ç¤ºã€‚

### æ¸¬è©¦åŠŸèƒ½

åœ¨ DevDashboard ä¸­å¯ä»¥ï¼š
- æŸ¥çœ‹ GPS æ•¸æ“š
- æ¨¡æ“¬ç‰©å“æ‹¾å–ï¼ˆæ¸¬è©¦ç£å¸ç³»çµ±ï¼‰
- èª¿æ•´é«”åŠ›/è€ä¹…åº¦
- æ¸…é™¤æ­·å²æ•¸æ“š

---

## ğŸ› å·²çŸ¥å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1: ç£å¸ç³»çµ±æœªå•Ÿå‹•

**ç—‡ç‹€**: æ¡é›†æ™‚æ²’æœ‰ä»»ä½•ç‰©å“æª¢æ¸¬åæ‡‰

**è§£æ±ºæ–¹æ¡ˆ**:
```typescript
// æª¢æŸ¥ç£å¸ç³»çµ±æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–
useEffect(() => {
  const callbacks = {
    onT3Encounter: handleT3Encounter,
    onStaminaShortage: handleStaminaShortage,
    // ... å…¶ä»–å›èª¿
  };
  magnetSystem.initialize(callbacks);
}, []);
```

### å•é¡Œ 2: é£„å­—ä¸é¡¯ç¤º

**ç—‡ç‹€**: æ‹¾å–ç‰©å“æ™‚æ²’æœ‰é£„å­—åé¥‹

**è§£æ±ºæ–¹æ¡ˆ**:
```typescript
// ç¢ºä¿ FloatingTextSystem åœ¨æœ€å¤–å±¤æ¸²æŸ“ï¼ˆé«˜ zIndexï¼‰
<FloatingTextSystem texts={floatingTexts} onRemove={removeText} />
```

### å•é¡Œ 3: èƒŒåŒ…å¡ç‰‡é€²åº¦ç’°ä¸æ›´æ–°

**ç—‡ç‹€**: è² é‡è®ŠåŒ–ä½†é€²åº¦ç’°ä¸å‹•

**è§£æ±ºæ–¹æ¡ˆ**:
```typescript
// ç¢ºä¿ BackpackCard è¨‚é–±äº†æ­£ç¢ºçš„ store
const totalWeight = useInventoryStore((state) => state.totalWeight);
const effectiveMaxWeight = usePlayerStore((state) => state.getEffectiveMaxWeight());
```

---

## ğŸ“Š æ€§èƒ½å„ªåŒ–å»ºè­°

### 1. ç£å¸ç³»çµ±æª¢æ¸¬é »ç‡

```typescript
// èª¿æ•´æª¢æ¸¬é–“éš”ï¼ˆé»˜èª 2 ç§’ï¼‰
this.detectionInterval = setInterval(() => {
  // ...
}, 2000); // å¢åŠ åˆ° 3000 å¯æ¸›å°‘ CPU æ¶ˆè€—
```

### 2. é£„å­—å‹•ç•«å„ªåŒ–

```typescript
// ä½¿ç”¨ useNativeDriver ç¢ºä¿å‹•ç•«æµæš¢
Animated.parallel([
  Animated.timing(translateY, {
    toValue: -80,
    duration: 1500,
    useNativeDriver: true, // âœ… å¿…é ˆç‚º true
  }),
  // ...
]);
```

### 3. Store è¨‚é–±å„ªåŒ–

```typescript
// åªè¨‚é–±éœ€è¦çš„å­—æ®µ
const stamina = usePlayerStore((state) => state.stamina); // âœ… å¥½
// é¿å…
const playerState = usePlayerStore(); // âŒ è¨‚é–±æ‰€æœ‰å­—æ®µï¼Œæœƒè§¸ç™¼ä¸å¿…è¦çš„é‡æ¸²æŸ“
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¨ˆåŠƒ

### Phase 1: å®Œå–„æ ¸å¿ƒåŠŸèƒ½ï¼ˆç•¶å‰ï¼‰
- âœ… PokÃ©mon GO é¢¨æ ¼ UI
- âœ… ç‹€æ…‹æ©Ÿé‚è¼¯
- âœ… ç£å¸ç³»çµ±
- âœ… æ•‘æ´å½ˆçª—
- âœ… é£„å­—åé¥‹

### Phase 2: æ•´åˆç†µå¼•æ“
- [ ] é€£æ¥ç£å¸ç³»çµ±èˆ‡ç†µå¼•æ“
- [ ] å¯¦ç¾çœŸå¯¦ç‰©å“ç”Ÿæˆé‚è¼¯
- [ ] æ•´åˆæ·±å±¤é ˜åŸŸæª¢æ¸¬

### Phase 3: å¸è²¨/é‡é¤é‚è¼¯
- [ ] å¸è²¨çµç®—å½ˆçª—ï¼ˆé¡¯ç¤ºæ”¶ç›Šï¼‰
- [ ] é‡é¤é«”åŠ›æ¢å¾©è¨ˆç®—
- [ ] ç¶­ä¿®ç³»çµ±æ•´åˆ

### Phase 4: å»£å‘Šæ•´åˆ
- [ ] æ•´åˆ AdMob SDK
- [ ] å¯¦ç¾çœŸå¯¦å»£å‘Šæ’­æ”¾
- [ ] å»£å‘Šä¸Šé™è¿½è¹¤

---

## ğŸ’¡ æœ€ä½³å¯¦è¸

### 1. ç‹€æ…‹ç®¡ç†

```typescript
// âœ… æ­£ç¢ºï¼šä½¿ç”¨ Zustand store
const stamina = usePlayerStore((state) => state.stamina);

// âŒ éŒ¯èª¤ï¼šç›´æ¥ä¿®æ”¹ store
usePlayerStore.setState({ stamina: 100 }); // è·³éé©—è­‰é‚è¼¯

// âœ… æ­£ç¢ºï¼šä½¿ç”¨ action
usePlayerStore.getState().updateStamina(10);
```

### 2. éŒ¯èª¤è™•ç†

```typescript
// âœ… æ­£ç¢ºï¼šæ•ç²éŒ¯èª¤ä¸¦é¡¯ç¤ºå‹å–„æç¤º
try {
  await magnetSystem.onItemDetected(item);
} catch (error) {
  console.error('[GameScreen] ç‰©å“æª¢æ¸¬å¤±æ•—:', error);
  showFloatingText('ç‰©å“æª¢æ¸¬å¤±æ•—', '#F44336');
}
```

### 3. æ¸…ç†è³‡æº

```typescript
// âœ… æ­£ç¢ºï¼šåœ¨ useEffect æ¸…ç†å‡½æ•¸ä¸­é‡‹æ”¾è³‡æº
useEffect(() => {
  magnetSystem.start();
  
  return () => {
    magnetSystem.stop(); // åœæ­¢ç£å¸ç³»çµ±
    backgroundLocationService.stopBackgroundTracking(); // åœæ­¢èƒŒæ™¯æœå‹™
  };
}, []);
```

---

## ğŸ“ æ”¯æ´èˆ‡åé¥‹

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹ï¼š
1. æª¢æŸ¥ `console.log` è¼¸å‡ºï¼ˆæ¨™è¨˜ç‚º `[GameScreen]`, `[MagnetSystem]` ç­‰ï¼‰
2. ä½¿ç”¨ DevDashboard é€²è¡Œèª¿è©¦
3. æŸ¥çœ‹æœ¬æ–‡æª”çš„ã€Œå·²çŸ¥å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆã€

---

**ç‰ˆæœ¬**: v9.0 Plus  
**æœ€å¾Œæ›´æ–°**: 2026-01-14  
**ä½œè€…**: Cursor AI Assistant
